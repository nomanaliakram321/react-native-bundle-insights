<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unused Code Detection - React Native Bundle Insights</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #58a6ff;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #8b949e;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
        }

        .stat-label {
            color: #8b949e;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #58a6ff;
        }

        .stat-card.warning .stat-value {
            color: #f85149;
        }

        .section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #58a6ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .file-item {
            padding: 12px;
            border-bottom: 1px solid #21262d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: #0d1117;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-path {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            color: #c9d1d9;
            flex: 1;
        }

        .file-size {
            color: #8b949e;
            font-size: 12px;
            margin-left: 15px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-danger {
            background: #da3633;
            color: #fff;
        }

        .badge-warning {
            background: #d29922;
            color: #fff;
        }

        .verify-note {
            background: #0d1117;
            border: 1px solid #30363d;
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 12px;
            color: #8b949e;
            display: none;
        }

        .verify-note.show {
            display: block;
        }

        .verify-suggestion {
            color: #58a6ff;
            font-family: 'Monaco', 'Courier New', monospace;
            background: #161b22;
            padding: 2px 6px;
            border-radius: 3px;
            margin: 0 4px;
        }

        .badge-info {
            background: #1f6feb;
            color: #fff;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }

        .spinner {
            border: 3px solid #21262d;
            border-top: 3px solid #58a6ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            background: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: #58a6ff;
        }

        .filter-btn {
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #30363d;
        }

        .filter-btn.active {
            background: #1f6feb;
            border-color: #1f6feb;
            color: #fff;
        }

        .action-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #238636;
            color: #fff;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn-secondary {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }

        .btn-secondary:hover {
            background: #30363d;
        }

        .code-snippet {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            color: #c9d1d9;
            overflow-x: auto;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .directory-group {
            margin-bottom: 20px;
        }

        .directory-header {
            background: #0d1117;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .directory-header:hover {
            background: #161b22;
        }

        .directory-name {
            font-weight: 600;
            color: #58a6ff;
        }

        .directory-count {
            color: #8b949e;
            font-size: 12px;
        }

        .file-category {
            margin-bottom: 30px;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #21262d;
        }

        .category-icon {
            font-size: 24px;
        }

        .category-title {
            font-size: 18px;
            font-weight: 600;
            color: #c9d1d9;
        }

        .category-count {
            color: #8b949e;
            font-size: 14px;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóëÔ∏è Unused Code Detection</h1>
        <p class="subtitle">Find unused imports in your codebase to reduce bundle size</p>
        <div style="background: linear-gradient(135deg, #1f2937 0%, #374151 100%); border: 2px solid #f59e0b; padding: 20px; margin-bottom: 25px; border-radius: 10px; box-shadow: 0 4px 16px rgba(245, 158, 11, 0.2); display: none;" id="warningBanner">
            <div style="display: flex; align-items: start; gap: 15px;">
                <div style="font-size: 48px; line-height: 1;">‚ö†Ô∏è</div>
                <div style="flex: 1;">
                    <h2 style="color: #fbbf24; margin: 0 0 12px 0; font-size: 20px; font-weight: 700;">
                        Important: Manual Review Required
                    </h2>
                    <p style="margin: 0 0 12px 0; color: #d1d5db; font-size: 15px; line-height: 1.6;">
                        These files appear <strong>potentially unused</strong> based on static import analysis. However, this analysis may have <strong>false positives</strong> from:
                    </p>
                    <ul style="margin: 0 0 12px 20px; color: #d1d5db; font-size: 14px; line-height: 1.8;">
                        <li><strong style="color: #fbbf24;">React Navigation screens:</strong> Files imported dynamically via navigation stacks</li>
                        <li><strong style="color: #fbbf24;">Lazy-loaded components:</strong> Components loaded with React.lazy() or dynamic import()</li>
                        <li><strong style="color: #fbbf24;">Barrel exports:</strong> index.ts files that re-export other modules</li>
                        <li><strong style="color: #fbbf24;">Service files:</strong> Files imported via dependency injection or configuration</li>
                    </ul>
                    <div style="background: rgba(245, 158, 11, 0.15); border-left: 3px solid #fbbf24; padding: 12px; border-radius: 6px;">
                        <p style="margin: 0; color: #fbbf24; font-size: 14px; font-weight: 600;">
                            üîç <strong>Always verify before deleting:</strong> Search your entire codebase for references to the file name or component name. Test your app after commenting out imports!
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Analyzing unused code...</p>
        </div>

        <div id="content" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Project Files</div>
                    <div class="stat-value" id="totalFiles">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Files In Use</div>
                    <div class="stat-value" style="color: #3fb950;" id="usedFiles">0</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-label">Unused Imports Detected</div>
                    <div class="stat-value" id="unusedImports">0</div>
                </div>
            </div>

            <!-- Unused Imports Section -->
            <div class="section" id="unusedImportsSection" style="display: none;">
                <h2 class="section-title">
                    üîç Unused Imports
                    <span style="font-size: 14px; color: #8b949e; font-weight: normal; margin-left: 10px;">
                        Imports that are not used in their respective files
                    </span>
                </h2>

                <div style="background: #1f2937; border-left: 4px solid #f85149; padding: 15px; margin-bottom: 20px; border-radius: 6px;">
                    <strong style="color: #f85149;">üöÄ Performance Impact</strong>
                    <p style="margin-top: 8px; color: #8b949e; font-size: 14px;">
                        Unused imports can bloat your bundle size and slow down compilation. Remove them to improve performance.
                    </p>
                </div>

                <div class="filter-bar">
                    <input
                        type="text"
                        class="search-input"
                        id="searchImportsInput"
                        placeholder="Search by file name or import name..."
                    >
                </div>

                <div id="unusedImportsList"></div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="copyUnusedImports()">üìã Copy List</button>
                    <button class="btn btn-secondary" onclick="exportUnusedImports()">üíæ Export to File</button>
                    <button class="btn btn-primary" onclick="generateRemovalGuide()">üìñ Show Removal Guide</button>
                </div>

                <div id="removalGuide" style="display: none;">
                    <h3 style="margin-top: 30px; margin-bottom: 15px; color: #58a6ff;">
                        How to Remove Unused Imports
                    </h3>
                    <p style="color: #8b949e; margin-bottom: 15px;">
                        You can use ESLint or your IDE to automatically remove unused imports:
                    </p>
                    <div class="code-snippet">
# Using ESLint with auto-fix (recommended)
npx eslint --fix src/

# Or install eslint-plugin-unused-imports
npm install --save-dev eslint-plugin-unused-imports

# Add to .eslintrc:
{
  "plugins": ["unused-imports"],
  "rules": {
    "unused-imports/no-unused-imports": "error"
  }
}</div>
                </div>
            </div>

            <!-- Unused Files Section -->
            <div class="section" id="unusedFilesSection" style="display: none;">
                <h2 class="section-title">
                    üóëÔ∏è Potentially Unused Files
                    <span style="font-size: 14px; color: #8b949e; font-weight: normal; margin-left: 10px;">
                        Files not detected in static import chain - review before removing
                    </span>
                </h2>

                <div class="filter-bar">
                    <input
                        type="text"
                        class="search-input"
                        id="searchInput"
                        placeholder="Search files... (e.g., 'components', '.tsx', 'utils')"
                    >
                    <button class="filter-btn active" onclick="filterFiles('all')">All</button>
                    <button class="filter-btn" onclick="filterFiles('components')">Components</button>
                    <button class="filter-btn" onclick="filterFiles('utils')">Utils</button>
                    <button class="filter-btn" onclick="filterFiles('screens')">Screens</button>
                </div>

                <div id="filesByDirectory"></div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="copyFileList()">üìã Copy File List</button>
                    <button class="btn btn-secondary" onclick="exportToFile()">üíæ Export to File</button>
                    <button class="btn btn-primary" onclick="showCleanupScript()">üöÄ Generate Cleanup Script</button>
                </div>

                <div id="cleanupScript" style="display: none;">
                    <h3 style="margin-top: 30px; margin-bottom: 15px; color: #58a6ff;">
                        Cleanup Script
                    </h3>
                    <p style="color: #8b949e; margin-bottom: 15px;">
                        ‚ö†Ô∏è Review carefully before running! This will delete files.
                    </p>
                    <div class="code-snippet" id="scriptContent"></div>
                    <button class="btn btn-secondary" style="margin-top: 10px;" onclick="copyScript()">
                        üìã Copy Script
                    </button>
                </div>
            </div>

            <!-- Empty State -->
            <div class="section" id="emptyState" style="display: none;">
                <div class="empty-state">
                    <div class="empty-state-icon">‚úÖ</div>
                    <h2 style="color: #3fb950; margin-bottom: 10px;">No Unused Imports Found!</h2>
                    <p style="color: #8b949e;">Your codebase is clean - all imports are being used.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allUnusedFiles = [];
        let allUnusedImports = [];
        let currentFilter = 'all';

        async function loadData() {
            try {
                console.log('Fetching unused code data...');
                const response = await fetch('/api/source-analysis');
                console.log('Response status:', response.status);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.error || 'Unknown error'}`);
                }

                const data = await response.json();
                console.log('Data loaded:', data);

                allUnusedFiles = data.unusedFiles || [];
                allUnusedImports = data.unusedImports || [];

                // Update stats (only show total files, files in use, and unused imports)
                document.getElementById('totalFiles').textContent = data.totalProjectFiles || 0;
                const usedCount = data.totalProjectFiles - allUnusedFiles.length;
                document.getElementById('usedFiles').textContent = usedCount;
                document.getElementById('unusedImports').textContent = allUnusedImports.length;

                // Show unused imports section if there are any
                if (allUnusedImports.length > 0) {
                    document.getElementById('unusedImportsSection').style.display = 'block';
                    renderUnusedImports(allUnusedImports);
                }

                // Show content or empty state
                if (allUnusedImports.length === 0) {
                    document.getElementById('emptyState').style.display = 'block';
                }
                // Note: Unused files section is permanently hidden

                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').innerHTML = `
                    <p style="color: #f85149;">Error loading unused code data</p>
                    <p style="font-size: 14px; margin-top: 10px;">${error.message}</p>
                `;
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function renderFilesByDirectory(files) {
            const byDirectory = {};

            files.forEach(file => {
                const parts = file.split('/');
                const dir = parts.slice(0, -1).join('/') || 'root';
                if (!byDirectory[dir]) {
                    byDirectory[dir] = [];
                }
                byDirectory[dir].push(file);
            });

            const container = document.getElementById('filesByDirectory');
            container.innerHTML = '';

            // Sort directories by number of files (descending)
            const sortedDirs = Object.keys(byDirectory).sort((a, b) =>
                byDirectory[b].length - byDirectory[a].length
            );

            sortedDirs.forEach(dir => {
                const dirFiles = byDirectory[dir];
                const dirGroup = document.createElement('div');
                dirGroup.className = 'directory-group';

                const header = document.createElement('div');
                header.className = 'directory-header';
                header.innerHTML = `
                    <span class="directory-name">üìÅ ${dir}</span>
                    <span class="directory-count">${dirFiles.length} file${dirFiles.length !== 1 ? 's' : ''}</span>
                `;

                const fileList = document.createElement('div');
                fileList.className = 'file-list';
                // Start expanded by default
                fileList.style.display = 'block';

                dirFiles.forEach((file, idx) => {
                    const fileName = file.split('/').pop();
                    const componentName = fileName.replace(/\.(tsx?|jsx?)$/, '');
                    const fileId = `file-${Date.now()}-${idx}`;

                    const fileItem = document.createElement('div');
                    fileItem.style.borderBottom = '1px solid #21262d';
                    fileItem.style.padding = '12px';

                    fileItem.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="file-path">${file}</span>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <span class="badge badge-warning">Review</span>
                                <button
                                    onclick="showCommentedCode('${fileId}', '${escapeForJSString(file)}', '${componentName}')"
                                    style="background: #238636; border: 1px solid #30363d; color: #fff; padding: 4px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;"
                                >
                                    üìã Show Commented Code
                                </button>
                            </div>
                        </div>
                        <div id="${fileId}" class="verify-note"></div>
                    `;
                    fileList.appendChild(fileItem);
                });

                dirGroup.appendChild(header);
                dirGroup.appendChild(fileList);
                container.appendChild(dirGroup);

                // Toggle collapse
                header.onclick = () => {
                    fileList.style.display = fileList.style.display === 'none' ? 'block' : 'none';
                };
            });
        }

        function filterFiles(category) {
            currentFilter = category;

            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            let filtered = allUnusedFiles;

            if (category === 'components') {
                filtered = allUnusedFiles.filter(f =>
                    f.includes('/components/') || f.includes('/component/')
                );
            } else if (category === 'utils') {
                filtered = allUnusedFiles.filter(f =>
                    f.includes('/utils/') || f.includes('/util/') || f.includes('/helpers/')
                );
            } else if (category === 'screens') {
                filtered = allUnusedFiles.filter(f =>
                    f.includes('/screens/') || f.includes('/screen/') || f.includes('/pages/')
                );
            }

            renderFilesByDirectory(filtered);
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const filtered = allUnusedFiles.filter(f =>
                        f.toLowerCase().includes(query)
                    );
                    renderFilesByDirectory(filtered);
                });
            }
        });

        function copyFileList() {
            const text = allUnusedFiles.join('\n');
            navigator.clipboard.writeText(text);
            alert('‚úÖ File list copied to clipboard!');
        }

        function exportToFile() {
            const text = allUnusedFiles.join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'unused-files.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function showCleanupScript() {
            const scriptDiv = document.getElementById('cleanupScript');
            const scriptContent = document.getElementById('scriptContent');

            const script = `#!/bin/bash
# Generated cleanup script for unused files
# Review carefully before running!

echo "‚ö†Ô∏è  This will delete ${allUnusedFiles.length} files. Are you sure? (yes/no)"
read confirmation

if [ "$confirmation" != "yes" ]; then
    echo "‚ùå Aborted"
    exit 1
fi

echo "üóëÔ∏è  Removing unused files..."

${allUnusedFiles.map(file => `rm "${file}"`).join('\n')}

echo "‚úÖ Done! Removed ${allUnusedFiles.length} files"
`;

            scriptContent.textContent = script;
            scriptDiv.style.display = 'block';
            scriptDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function copyScript() {
            const script = document.getElementById('scriptContent').textContent;
            navigator.clipboard.writeText(script);
            alert('‚úÖ Script copied to clipboard!');
        }

        function escapeForJSString(str) {
            return str.replace(/\\/g, '\\\\').replace(/'/g, "\\'");
        }

        function showCommentedCode(fileId, filePath, componentName) {
            const note = document.getElementById(fileId);

            if (note.classList.contains('show')) {
                note.classList.remove('show');
                return;
            }

            // Generate commented import/export statements
            const commentedImport = `// import ${componentName} from './${componentName}';`;
            const commentedExport = `// export { ${componentName} };`;
            const commentedDefaultExport = `// export default ${componentName};`;

            note.classList.add('show');
            note.innerHTML = `
                <strong style="color: #c9d1d9;">üìù Comment out imports of this file:</strong>
                <div style="margin-top: 12px; background: #161b22; padding: 12px; border-radius: 6px; border-left: 3px solid #58a6ff;">
                    <div style="color: #8b949e; font-size: 12px; margin-bottom: 8px;">Copy and replace your import statement with:</div>
                    <div style="font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; color: #6e7681; margin-bottom: 8px;">
                        ${commentedImport}
                    </div>
                    <div style="color: #8b949e; font-size: 12px; margin-top: 12px; margin-bottom: 8px;">Or if it's a default import:</div>
                    <div style="font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; color: #6e7681; margin-bottom: 8px;">
                        // import ${componentName} from '${filePath.replace('/src/', './')}';
                    </div>
                    <button
                        onclick="copyToClipboard('${commentedImport}')"
                        style="background: #238636; color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 8px; font-weight: 600;"
                    >
                        üìã Copy Commented Import
                    </button>
                </div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #30363d;">
                    <div style="color: #8b949e; font-size: 13px;">
                        <strong style="color: #58a6ff;">üí° How to use:</strong>
                        <ol style="margin: 8px 0 0 20px; line-height: 1.6;">
                            <li>Search for imports of "<span style="color: #c9d1d9; font-family: monospace;">${componentName}</span>" in your project</li>
                            <li>Replace those imports with the commented version above</li>
                            <li>Test your app - if it works, the file is truly unused</li>
                            <li>If the app breaks, uncomment and keep the file</li>
                        </ol>
                    </div>
                </div>
            `;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            alert('‚úÖ Copied to clipboard!\n\nNow paste it in your code to comment out the import.');
        }

        function renderUnusedImports(imports) {
            const container = document.getElementById('unusedImportsList');
            container.innerHTML = '';

            // Group imports by file
            const byFile = {};
            imports.forEach(imp => {
                if (!byFile[imp.file]) {
                    byFile[imp.file] = [];
                }
                byFile[imp.file].push(imp);
            });

            // Sort by number of unused imports per file (descending)
            const sortedFiles = Object.keys(byFile).sort((a, b) =>
                byFile[b].length - byFile[a].length
            );

            sortedFiles.forEach(file => {
                const fileImports = byFile[file];
                const fileGroup = document.createElement('div');
                fileGroup.className = 'directory-group';
                fileGroup.style.marginBottom = '20px';

                const header = document.createElement('div');
                header.className = 'directory-header';
                header.style.background = '#161b22';
                header.innerHTML = `
                    <span class="directory-name">üìÑ ${file}</span>
                    <span class="directory-count">${fileImports.length} unused import${fileImports.length !== 1 ? 's' : ''}</span>
                `;

                const importList = document.createElement('div');
                importList.style.marginTop = '10px';

                fileImports.forEach((imp, idx) => {
                    const importItem = document.createElement('div');
                    importItem.style.borderBottom = '1px solid #21262d';
                    importItem.style.padding = '12px';
                    importItem.style.background = '#0d1117';

                    importItem.innerHTML = `
                        <div style="display: flex; align-items: start; justify-content: space-between; gap: 15px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                    <span style="color: #f85149; font-weight: 600; font-size: 14px;">${imp.importName}</span>
                                    <span class="badge badge-danger">Line ${imp.line}</span>
                                </div>
                                <div style="font-family: 'Monaco', 'Courier New', monospace; font-size: 12px; color: #8b949e; background: #161b22; padding: 8px 12px; border-radius: 4px; border-left: 3px solid #f85149;">
                                    ${escapeHtml(imp.importStatement)}
                                </div>
                            </div>
                            <button
                                class="quick-fix-btn"
                                style="background: #238636; border: none; color: #fff; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; white-space: nowrap;"
                            >
                                üîß Quick Fix
                            </button>
                        </div>
                    `;

                    // Add click handler using addEventListener
                    const quickFixBtn = importItem.querySelector('.quick-fix-btn');
                    quickFixBtn.addEventListener('click', () => {
                        showQuickFix(file, imp.line, imp.importStatement);
                    });

                    importList.appendChild(importItem);
                });

                fileGroup.appendChild(header);
                fileGroup.appendChild(importList);
                container.appendChild(fileGroup);

                // Toggle collapse
                header.onclick = () => {
                    importList.style.display = importList.style.display === 'none' ? 'block' : 'none';
                };
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showQuickFix(file, line, importStatement) {
            // importStatement is already a raw string, no need to decode

            // Create a custom modal instead of alert
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: #161b22;
                border: 1px solid #30363d;
                border-radius: 12px;
                padding: 30px;
                max-width: 600px;
                width: 90%;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            `;

            content.innerHTML = `
                <h3 style="color: #58a6ff; margin-bottom: 20px; font-size: 20px;">üîß Quick Fix Options</h3>

                <div style="background: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: #8b949e; font-size: 13px; margin-bottom: 5px;">File:</div>
                    <div style="font-family: 'Monaco', 'Courier New', monospace; color: #58a6ff; font-size: 14px;">${file}</div>
                    <div style="color: #8b949e; font-size: 13px; margin-top: 10px; margin-bottom: 5px;">Line ${line}:</div>
                    <div style="font-family: 'Monaco', 'Courier New', monospace; color: #f85149; font-size: 12px; background: #161b22; padding: 8px; border-radius: 4px;">${escapeHtml(importStatement)}</div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">
                    <button id="btnOpenVSCode" style="background: #1f6feb; color: #fff; border: none; padding: 14px; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 700; box-shadow: 0 4px 12px rgba(31, 111, 235, 0.3);">
                        üíª Open in VS Code
                    </button>

                    <button id="btnCopyPath" style="background: #238636; color: #fff; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        üìã Copy File Path
                    </button>

                    <button id="btnCopyImport" style="background: #6e40c9; color: #fff; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        üìù Copy Import Statement
                    </button>
                </div>

                <div style="background: #1f2937; border-left: 3px solid #58a6ff; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
                    <div style="font-size: 13px; color: #8b949e;">
                        <strong style="color: #58a6ff;">üí° Tip:</strong> Use VS Code's "Organize Imports" (Shift+Alt+O) to auto-remove all unused imports
                    </div>
                </div>

                <button id="btnClose" style="background: #21262d; color: #c9d1d9; border: 1px solid #30363d; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%;">
                    Close
                </button>
            `;

            modal.appendChild(content);
            document.body.appendChild(modal);

            // Add event listeners
            content.querySelector('#btnOpenVSCode').addEventListener('click', () => {
                // Use VS Code URL scheme to open file at specific line
                const vscodeUrl = `vscode://file${file}:${line}`;
                window.location.href = vscodeUrl;

                // Show confirmation
                setTimeout(() => {
                    alert(`‚úÖ Opening in VS Code!\n\nFile: ${file}\nLine: ${line}\n\nIf VS Code doesn't open, make sure the 'code' command is installed in your PATH.`);
                }, 100);
            });

            content.querySelector('#btnCopyPath').addEventListener('click', () => {
                navigator.clipboard.writeText(file);
                alert(`‚úÖ Copied file path: ${file}\n\nNow open it at line ${line} in your editor!`);
            });

            content.querySelector('#btnCopyImport').addEventListener('click', () => {
                navigator.clipboard.writeText(importStatement);
                alert(`‚úÖ Copied import statement to clipboard!\n\nYou can now search for it in your file.`);
            });

            content.querySelector('#btnClose').addEventListener('click', () => {
                modal.remove();
            });

            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function copyUnusedImports() {
            const text = allUnusedImports.map(imp =>
                `${imp.file}:${imp.line} - ${imp.importName} (${imp.importStatement})`
            ).join('\n');
            navigator.clipboard.writeText(text);
            alert('‚úÖ Unused imports list copied to clipboard!');
        }

        function exportUnusedImports() {
            const text = allUnusedImports.map(imp =>
                `${imp.file}:${imp.line} - ${imp.importName}\n  ${imp.importStatement}`
            ).join('\n\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'unused-imports.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function generateRemovalGuide() {
            const guideDiv = document.getElementById('removalGuide');
            if (guideDiv.style.display === 'none') {
                guideDiv.style.display = 'block';
                guideDiv.scrollIntoView({ behavior: 'smooth' });
            } else {
                guideDiv.style.display = 'none';
            }
        }

        // Search functionality for imports
        document.addEventListener('DOMContentLoaded', () => {
            const searchImportsInput = document.getElementById('searchImportsInput');
            if (searchImportsInput) {
                searchImportsInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const filtered = allUnusedImports.filter(imp =>
                        imp.file.toLowerCase().includes(query) ||
                        imp.importName.toLowerCase().includes(query) ||
                        imp.importStatement.toLowerCase().includes(query)
                    );
                    renderUnusedImports(filtered);
                });
            }
        });

        // Load data on page load
        loadData();
    </script>
</body>
</html>
